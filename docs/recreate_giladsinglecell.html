<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Brana Mittleman" />

<meta name="date" content="2017-01-11" />

<title>Recreate Gilad lab single cell</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Cell cycle</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jdblischak/workflowr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Recreate Gilad lab single cell</h1>
<h4 class="author"><em>Brana Mittleman</em></h4>
<h4 class="date"><em>January 11, 2017</em></h4>

</div>


<p><strong>Last updated:</strong> 2017-01-19</p>
<p><strong>Code version:</strong> 505c3ac</p>
<p>I will use this to document my recreating of the single cell data processing from <a href="http://jdblischak.github.io/singleCellSeq/analysis/process-samples.html" class="uri">http://jdblischak.github.io/singleCellSeq/analysis/process-samples.html</a>.</p>
<div id="general-information-for-committing-changes-to-the-git-hub-site" class="section level3">
<h3>General information for committing changes to the git hub site:</h3>
<pre><code>git add analysis/*.Rmd
git commit -m &quot;message&quot;</code></pre>
<p>Run <code>commit_site()</code> in R terminal.</p>
<pre><code>git push origin master</code></pre>
</div>
<div id="programs-for-analysis" class="section level3">
<h3>Programs for analysis</h3>
<p>First I need to document the programs I will need to add to midway to complete the processing recreation.</p>
<ul>
<li><p>umitools v2.1.1 -fastqc <strong>on midway- not told you need it in github commands!</strong></p></li>
<li>sickle version 1.33 <strong>used make function</strong></li>
<li>Subread version 1.5.0-p1 <strong>on midway</strong></li>
<li>samtools version 0.1.18-dev (r982:313) <strong>version 1.2 on midway</strong></li>
<li>UMI-tools (version e0ade5d)</li>
<li><p>featureCounts version 1.5.0-p1 <strong>i think this is a part of subread</strong></p></li>
</ul>
<p>To use modules on midway:</p>
<pre><code>module load [name]
module list #show loaded modules 
module unload [name]
</code></pre>
</div>
<div id="moving-the-files-from-pps-to-midway" class="section level3">
<h3>Moving the files from pps to midway</h3>
<p>First I copy the first individual, first plate from spudhead to gateway.</p>
<pre><code>scp 19098.1* pps-gateway:</code></pre>
<p>Move the files to midway:</p>
<pre><code>scp 19098.1* brimittleman@midway.rcc.uchicago.edu:</code></pre>
<p>Remove the files from gateway:</p>
<pre><code>rm 19098.1*</code></pre>
<p>Move to the midway cluster and move the files to a directory in scratch.</p>
<pre><code>mv 19098.1* scratch-midway/19098.1 </code></pre>
</div>
<div id="create-genome-for-mapping" class="section level3">
<h3>Create genome for mapping</h3>
<p>Create a code directory for scripts.</p>
<pre><code>mkdir code</code></pre>
<p>Copy contents of create-genome.sh from Johnâ€™s github to a script in my own directory using vi.</p>
<pre><code>vi create-genome.sh</code></pre>
<p>Use escape then :wq to write out file. Make a file executable using the following:</p>
<pre><code>chmod 700 &lt;file&gt;</code></pre>
<p>Run each script seperatly:</p>
<pre><code>sbatch --mem=8g --wrap=&quot;create-genome.sh genome&quot;</code></pre>
<p>This submits the job.To view the job I use this command.</p>
<pre><code>squeue -u brimittleman</code></pre>
<p>Try this one command at a time in a genome directory. This is buiding the reference index genome for later transcriptome mapping.</p>
<pre><code>mkdir genome
cd genome
wget http://hgdownload.soe.ucsc.edu/goldenPath/hg19/chromosomes/chr{1..22}.fa.gz
wget http://hgdownload.soe.ucsc.edu/goldenPath/hg19/chromosomes/chr{X,Y,M}.fa.gz
gunzip chr*fa.gz
wget http://tools.invitrogen.com/downloads/ERCC92.fa
#load subread
subread-buildindex -o combined *.fa</code></pre>
<p>I need to move data and scripts to the gilad project folder. scratch is not permanant.</p>
<pre><code>mkdir /project/gilad/brimittleman</code></pre>
</div>
<div id="run-fastqc" class="section level3">
<h3>Run FastQC</h3>
<p>Create run-fastqc.sh file:</p>
<pre><code>vi run-fastqc.sh
chmod 700 run-fastqc.sh #make file executable</code></pre>
<p>Load the fastqc package and submit the job to the cluster:</p>
<pre><code>sbatch --mem=2g run-fastqc.sh ../19098.1/19098.1.A09.GGTATTCA.L003.R1.C6WURACXX.fastq.gz #Run this command for each fastq. </code></pre>
<p><strong>Each new Session: load fastqc, subread, samtools. </strong></p>
<p>Problem at this step:</p>
<ul>
<li><p>Files -19098.1.C08.TTGGTACA.L002.R1.C6WYKACXX.fastq.gz to the end are empty. Cannot run the fast qc on these.</p></li>
<li><p>To check this I go back to the pps spudhead and look at the files using.</p></li>
</ul>
<pre><code> zcat file |wc -l</code></pre>
<ul>
<li>The files are correct on spudhead. I will recopy them over to midway.</li>
</ul>
<p>Return to workflow:</p>
<pre><code>ls fastqc/ | wc -l
#201
</code></pre>
</div>
<div id="run-fastqc-2" class="section level3">
<h3>Run Fastqc 2</h3>
<p>Create run-fastqc.sh file:</p>
<pre><code>vi run-fastqc.sh
chmod 700 run-fastqc.sh #make file executable</code></pre>
<p>I am redoing the run fastqc step using a code that can run all of the files at the same time. I created a file called wrap-sbatch.sh that will run the run-fastqc.sh script in a loop over all of the fastq files. To complete this task all of the .sh scripts have to be in the same directory as the data. I also added a module load command for the fastqc module within the run-fastqc.sh script for completness. I run the sbatch for all of the fastq files using the following command:</p>
<pre><code>./wrap_sbatch.sh *fastq.gz</code></pre>
<p>This submits a job per file and I can check which jobs are running using the squeue - u command.</p>
<pre><code>ls fastqc/ | wc -l</code></pre>
<p>I have 447 lines in the fastqc directory.</p>
</div>
<div id="trim-umi" class="section level3">
<h3>Trim UMI</h3>
<p>Create the trim.sh script using the code from github in the code folder. Run this on all the files by making a script like the wrap_sbatch.sh one above.</p>
<pre><code>./wrap_trim.sh *fastq.gz
ls trim/*fastq.gz | wc -l
#224 this is one file per fastq.gz file in the data.  
ls invalid/*fastq.gz | wc -l
#no invalid files were created </code></pre>
</div>
<div id="quality-trim-3-end-of-reads" class="section level3">
<h3>Quality trim 3â€™ end of reads</h3>
<p>This uses sickle.sh to perform quality trimming of the 2â€™ end of the reats. I am using sickle-1.33. I will create a new wrap function for this segmant of code as well that will wrap the sickle.sh code. This code is within the trim folder because those are the files that I will run the command on.</p>
<pre><code>./wrap_sickle.sh *fastq.gz
ls sickle/*fastq.gz | wc -l
#224</code></pre>
</div>
<div id="map-genome" class="section level3">
<h3>Map genome</h3>
<p>I will use the map-subujunc.sh script to map the fastq files to the genome. I will create a new wrap script for this job as well. In the wrap I will load the subread module. I am copying the genome directory to sickle directory so all of the paths are easy.</p>
<pre><code>./wrap_map.sh *fastq.gz
ls bam/*bam | wc -l
#224</code></pre>
<p>The bam files were empty because I exceeded the memory needed. I added â€“mem=12G to the wrap script. I also changed it to the mstephen partition with â€“partition=mstephens and changed account with â€“account=pi-mstephens.</p>
</div>
<div id="process-bam-files" class="section level3">
<h3>Process bam files</h3>
<p>I will use the process-bam.sh script to process the bam files. I will create a new wrap script for this and will have it load samtools module in the script. All of this takes place in the bam folder.</p>
</div>
<div id="re-organize-my-files" class="section level2">
<h2>Re-organize my files</h2>
<p>I am reorganizing my data and code according to Johnâ€™s organization. I created a single cell directory in my home directory and in my project/gilad directory. I keep all of the scripts I have created in a code directory within the home single cell directory and edit my path variable to include this. The file containing my path directort in called .bashrc and is in the home directory. The fastq files were moved to a fastq directory within the single cell directory in the project folder. This way I am now keeping scripts in my home folder and have all large data in my project folder. I run jobs from the single cell directory in my project/gilad folder.</p>
<p>trim.sh fastq/19098.1.F12.AACCCATG.L006.R1.C723YACXX.fastq.gz</p>
<p>need to update the trim.sh script for the umi_tools extract command.</p>
</div>

<hr>
<p>
    This site was created with <a href="http://rmarkdown.rstudio.com">R Markdown</a>
</p>
<hr>

<!-- To enable disqus, uncomment the section below and provide your disqus_shortname -->

<!-- disqus
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rmarkdown'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
-->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
